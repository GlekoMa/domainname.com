---
title: ã€ŠR for Everyoneã€‹å°æ³¨ Part.1
author: ''
date: '2022-01-30'
slug: r-for-everyone
categories: []
tags: []
description: Rè¯­è¨€ï¼šå®ç”¨æ•°æ®åˆ†æå’Œå¯è§†åŒ–æŠ€æœ¯ï¼ˆåŸä¹¦ç¬¬2ç‰ˆï¼‰
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>


<p><em>2022.1.30-2.5</em></p>
<p><a href="https://book.douban.com/subject/34891734/"><img src="images/book_repo.jpg" style="max-width:22.5%;min-width:60px;float:right;" alt="R_for_Everyone" /></a></p>
<blockquote>
<p>Part.1èŒƒå›´ä¸ºç¬¬1-16ç« ï¼Œ17-26ç« ä¸ç†è®ºç»“åˆå¾ˆç´§å¯†ï¼Œç•™å¾…Part.2æ¢è®¨ï¼Œ27-30ç« åˆ™æ”¾åœ¨Part.3ã€‚</p>
</blockquote>
<blockquote>
<p>æ­¤ä¹¦ç»“æ„å¥½ï¼Œå†…å®¹ç›¸å¯¹è¾ƒæ–°ã€‚</p>
</blockquote>
<blockquote>
<p>è‹±æ–‡ç‰ˆ2017å¹´å‡ºç‰ˆï¼Œä¸­æ–‡ç‰ˆ2019å¹´12æœˆå‡ºç‰ˆï¼Œè€Œå¸‚é¢ä¸Šæµè¡Œçš„ä¸­æ–‡Rä¹¦ç›®ï¼Œå¾ˆå¤šéƒ½æ˜¯å†™ä½œäº13ã€14å¹´ï¼Œè€Œå½“æ—¶çš„ç¯å¢ƒä¸17å¹´ï¼ˆè¿™ä¸€å¹´Hadley Wickamçš„ã€ŠR for Data Scienceã€‹å‡ºç‰ˆï¼Œæ„å‘³ç€Tidyverseå·²ç›¸å¯¹æˆç†Ÿï¼‰ç›¸æ¯”æœ‰æ¯”è¾ƒå¤§çš„å·®åˆ«ã€‚</p>
</blockquote>
<blockquote>
<p>æ¨èï¼šGarrett Grolemund.<a href="https://rstudio-education.github.io/hopr/">Hands-On Programming with R</a> å…¶<a href="https://book.douban.com/subject/26808217/">ä¸­æ–‡ç‰ˆ</a>æ˜¯æˆ‘çš„å¯è’™ä¹¦ç±ï¼Œè®²è§£ç”±ä¸‰ä¸ªé¡¹ç›®é©±åŠ¨ï¼Œåœ¨æ²¡æœ‰ä»»ä½•åŸºç¡€çš„æƒ…å†µä¸‹ï¼Œä¸‰å¤©å°±å¯çœ‹å®Œã€‚ï¼ˆè¿™æœ¬ä¹¦å‡ ä¹æ²¡æœ‰ä½¿ç”¨ä»»ä½•RåŒ…ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå…¶ç¼ºç‚¹ä¹Ÿè®¸åªæœ‰å†…å®¹ç›¸å¯¹è¾ƒå°‘ã€‚è€ŒHadley Wickamçš„ã€ŠR for Data Scienceã€‹æ˜¯å…¶å§Šå¦¹ç¯‡ã€‚ï¼‰</p>
</blockquote>
<p>ç¬”è®°æ˜¯ä¸€ç§å¾ˆç§äººçš„ä¸œè¥¿ï¼Œç½‘ç»œä¸Šè®¸å¤šåšå®¢çš„å­¦ä¹ ç¬”è®°é€šå¸¸è¿‡äºå†—é•¿ï¼Œä¸”å†…å®¹å¸¸ä»…æ˜¯å¯¹åŸä¹¦çš„ä¸€äº›æç‚¼ï¼Œè¿™ç±»æ€»ç»“æ€§çš„ç¬”è®°é€‚ç”¨äºè‡ªå·±å¤ä¹ ï¼Œè€Œå°±æ•ˆç‡æ¥è¯´ï¼Œæœªå¿…é€‚åˆä»–è€…ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« é‡ŒåªåŒ…å«è®¸å¤šæ³¨é‡Šæ€§è´¨çš„ä¸œè¥¿ï¼Œæ•…åªç§°ä½œâ€œå°æ³¨â€ã€‚</p>
<p>â€œå°æ³¨â€åˆ†ä¸º<em>ä¸€èˆ¬æ³¨é‡Š</em>å’Œç‰¹é’ˆå¯¹æ­¤ä¹¦çš„<em>ç‰¹æ®Šæ³¨é‡Š</em>ã€‚</p>
<div id="ä¸€èˆ¬æ³¨é‡Š" class="section level2">
<h2>ä¸€èˆ¬æ³¨é‡Š</h2>
<div id="p17-2.2-rstudio" class="section level3">
<h3>P17 â€œ2.2 RStudioâ€</h3>
<p>åœ¨å¯åŠ¨æˆ–é€€å‡ºæ—¶ï¼Œå»ºè®®ä¸è¦æ¢å¤æˆ–ä¿å­˜.RDataæ–‡ä»¶ã€‚<br />
è¿™ç‚¹å…¶ä»–Rä¹¦ç±å¯èƒ½æ²¡æœ‰é¡¾åŠåˆ°ï¼Œä½†è®¾ç½®æˆâ€œNeverâ€ç¡®å®èƒ½æ–¹ä¾¿è®¸å¤šã€‚</p>
</div>
<div id="p61-6.2-è¯»å–excelæ•°æ®" class="section level3">
<h3>P61 â€œ6.2 è¯»å–Excelæ•°æ®â€</h3>
<p>ä¹¦ä¸­åªæåˆ°è¯»å–Excelæ–‡ä»¶å¯ä»¥ä½¿ç”¨readxlåŒ…ï¼›å¦‚æœæƒ³å†™å…¥Excelæ–‡ä»¶çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨openxlsxåŒ…ã€‚</p>
</div>
</div>
<div id="ç‰¹æ®Šæ³¨é‡Š" class="section level2">
<h2>ç‰¹æ®Šæ³¨é‡Š</h2>
<div id="p14-2.2-rstudio" class="section level3">
<h3>P14 â€œ2.2 RStudioâ€</h3>
<p>æœ¬èŠ‚ä¸­è®²äº†ä¸€äº›RStudioé‡Œçš„å¿«æ·é”®ï¼Œè¡¥å……å¦‚ä¸‹ï¼ˆWindowsï¼‰ï¼š</p>
<ul>
<li>Alt + - ï¼šå¿«é€Ÿè¾“å…¥â€œ &lt;- â€</li>
<li>Ctrl + Shift + M ï¼šå¿«é€Ÿè¾“å…¥â€œ %&gt;% â€ï¼ˆæˆ–â€œ |&gt; â€ï¼Œå¯ä»¥åœ¨RStudioä¸­è®¾ç½®ï¼‰</li>
<li>Ctrl + Alt + R ï¼šè¿è¡Œå½“å‰è„šæœ¬æ‰€æœ‰å†…å®¹</li>
<li>Shift + Enter ï¼šåœ¨æ§åˆ¶å°ä¸­æ¢è¡Œ</li>
<li>Ctrl + Shift +N ï¼šæ–°å»ºè„šæœ¬</li>
<li>Ctrl + S ï¼šä¿å­˜è„šæœ¬</li>
<li>Ctrl + W ï¼šå…³é—­å½“å‰è„šæœ¬</li>
<li>Ctrl + Shift + W ï¼šå…³é—­æ‰€æœ‰è„šæœ¬</li>
</ul>
</div>
<div id="p40-4.8-ç®¡é“" class="section level3">
<h3>P40 â€œ4.8 ç®¡é“â€</h3>
<p>æœ¬èŠ‚ä¸­æœ‰ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="r"><code>library(magrittr)
x &lt;- 1:10
mean(x)</code></pre>
<pre><code>## [1] 5.5</code></pre>
<pre class="r"><code>x %&gt;% mean</code></pre>
<pre><code>## [1] 5.5</code></pre>
<p>è¿™é‡Œçš„x %&gt;% meanä¹Ÿå¯ä»¥å†™æˆx %&gt;% mean()ã€‚äº‹å®ä¸Šï¼ŒR 4.1ç‰ˆæœ¬åï¼ŒåŸç”Ÿæ”¯æŒç®¡é“ï¼Œä½†ç®¡é“ç¬¦å†™æ³•ä¸magrittråŒ…ä¸åŒï¼Œå†™ä½œ |&gt; ï¼Œå®ç°åŸç†å’Œç”¨æ³•ä¹Ÿç•¥æœ‰ä¸åŒï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨ |&gt; å¿…é¡»å†™æˆx |&gt; mean()è€Œä¸èƒ½å†™æˆx |&gt; meanï¼Œç»Ÿè®¡ä¹‹éƒ½æœ‰ä¸æ­¤ç›¸å…³çš„<a href="https://d.cosx.org/d/422269-r-410">è®¨è®ºè´´</a></p>
</div>
<div id="p46-5.1-æ•°æ®æ¡†" class="section level3">
<h3>P46 â€œ5.1 æ•°æ®æ¡†â€</h3>
<p>æœ¬èŠ‚ä¸­æœ‰ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>x &lt;- 10:1
y &lt;- -4:5
q &lt;- c(&quot;Hockey&quot;,&quot;Football&quot;,&quot;Baseball&quot;,&quot;Curling&quot;,&quot;Rugby&quot;,
       &quot;Lacrosse&quot;,&quot;Basketball&quot;,&quot;Tennis&quot;,&quot;Cricket&quot;,&quot;Soccer&quot;)
theDF &lt;- data.frame(First=x,Second=y,Sport=q)
#çœç•¥Â·Â·Â·
class(theDF[,&quot;Sport&quot;])</code></pre>
<p>ä¹¦ä¸­ç»™å‡ºçš„ç»“æœä¸º</p>
<pre><code>[1] &quot;factor&quot;</code></pre>
<p>ä½†å®é™…è¿è¡Œç»“æœåº”ä¸º</p>
<pre><code>[1] &quot;character&quot;</code></pre>
<p>è¿™æ˜¯å› ä¸ºä¹¦ä¸­ä½¿ç”¨çš„Rç‰ˆæœ¬ä¸º3.4.0ï¼Œè€ŒRè‡ª<a href="https://stat.ethz.ch/pipermail/r-announce/2020/000653.html">4.0.0ç‰ˆæœ¬</a>ä»¥åï¼Œæ›´æ–°ä¸ºé»˜è®¤ä½¿ç”¨stringAsFactors = FALSEï¼Œå³ä¸å†é»˜è®¤å°†æ•°æ®æ¡†ï¼ˆdata.frameï¼‰ä¸­çš„åˆ—å‘é‡è½¬æ¢ä¸ºfactorï¼ˆå› å­ï¼‰å‘é‡ï¼Œæ‰€ä»¥å®é™…è¿è¡Œç»“æœä¼šä¸ä¹¦ä¸­æœ‰æ‰€å·®å¼‚ã€‚<br />
R 4.0.0äº2020å¹´4æœˆ24æ—¥å‘å¸ƒï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æ—©äºè¿™ä¸ªæ—¶é—´å‡ºç‰ˆçš„ä¹¦ç›®éƒ½ä¼šå­˜åœ¨ç›¸å…³é—®é¢˜ã€‚å› æ­¤é˜…è¯»ä¸€äº›ç›¸å…³èµ„æ–™æ—¶åº”å½“æ—¶åˆ»æ³¨æ„åˆ°è¿™ä¸ªå·®å¼‚ã€‚</p>
</div>
<div id="p53-5.2-åˆ—è¡¨" class="section level3">
<h3>P53 â€œ5.2 åˆ—è¡¨â€</h3>
<p>æœ¬èŠ‚æœ‰å¦‚ä¸‹å™è¿°ï¼š</p>
<p><em>â€œå¶å°”å¯¹åˆ—è¡¨æˆ–å‘é‡æˆ–æ•°æ®æ¡†å¢åŠ å…ƒç´ éƒ½è¿˜å¥½ï¼Œä½†æ˜¯ï¼Œå¦‚æœåå¤è¿™æ ·åšè®¡ç®—ä»£ä»·å°±å¤ªé«˜äº†ã€‚æ‰€ä»¥æœ€å¥½åˆ›å»ºæŒ‡å®šé•¿åº¦çš„åˆ—è¡¨ï¼Œç„¶åé€šè¿‡åˆé€‚çš„ç´¢å¼•å¢åŠ å…ƒç´ ã€‚â€</em></p>
<p>å¦‚æœæ²¡çœ‹æ‡‚è¿™æ®µæè¿°çš„è¯ï¼Œå­¦å®Œå¾ªç¯ç›¸å…³ç« èŠ‚åï¼Œé˜…è¯»ä¸‹é¢ä¸¤æ®µä»£ç ï¼š</p>
<p>äº‹å…ˆæŒ‡å®šäº†å˜é‡outputçš„é•¿åº¦ï¼š</p>
<pre class="r"><code>#system.timeå‡½æ•°å¯ä»¥è®¡ç®—ä¸€æ®µä»£ç çš„è¿è¡Œæ—¶é—´
system.time({
 output &lt;- rep(NA, 10000000)
 for (i in 1:10000000) {
 output[i] &lt;- i + 1
 }
})</code></pre>
<pre><code>## ç”¨æˆ· ç³»ç»Ÿ æµé€ 
## 0.59 0.00 0.60</code></pre>
<p>æœªäº‹å…ˆæŒ‡å®šoutputçš„é•¿åº¦ï¼š</p>
<pre class="r"><code>system.time({
 output &lt;- NA
 for (i in 1:10000000) {
 output[i] &lt;- i + 1
 }
})</code></pre>
<pre><code>## ç”¨æˆ· ç³»ç»Ÿ æµé€ 
## 2.92 0.09 3.08</code></pre>
<p>å¯ä»¥çœ‹å‡ºå‰è€…çš„è¿è¡Œé€Ÿåº¦å¤§çº¦æ˜¯åè€…çš„3.6å€ã€‚åŸå› æ˜¯åœ¨åè€…ä¸­ï¼ŒRä¸å¾—ä¸æ¯æ¬¡å¾ªç¯éƒ½æ‰©å……ä¸€æ¬¡outputå˜é‡çš„é•¿åº¦ã€‚å³æ¯æ¬¡å¾ªç¯ï¼ŒRéƒ½éœ€è¦åœ¨è®¡ç®—æœºå†…å­˜ä¸­å¤åˆ¶åŸé•¿åº¦çš„outputå˜é‡ï¼ŒåŒæ—¶è…¾å‡ºä¸€å—å®¹é‡æ›´å¤§çš„åŒºåŸŸï¼Œç”¨æ¥å­˜å‚¨æ–°é•¿åº¦çš„outputå˜é‡ï¼Œæœ€åæŠŠåŸä½ç½®çš„outputå˜é‡æ¸…é™¤ã€‚åœ¨åä¸€æ®µä»£ç ä¸­ï¼Œè¿™ä¸€ç³»åˆ—åˆ›å»ºã€å¤åˆ¶ã€ç²˜è´´ã€åˆ é™¤çš„ç¹çæ“ä½œå…±è¿›è¡Œäº†10000000æ¬¡ï¼è€Œå‰è€…çš„å†™æ³•å°±å¾ˆå¥½åœ°é¿å…äº†è¿™ä¸ªé—®é¢˜ï¼</p>
</div>
<div id="p61-6.2-è¯»å–excelæ•°æ®-1" class="section level3">
<h3>P61 â€œ6.2 è¯»å–Excelæ•°æ®â€</h3>
<p>æœ¬èŠ‚ä¸­æœ‰ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>download.file(url=&#39;http://www.jaredlander.com/data/ExcelExample.xlsx&#39;,
              destfile=&#39;data/ExcelExample.xlsx&#39;,method=&#39;curl&#39;)</code></pre>
<p>è¿è¡Œåº”è¯¥ä¼šæŠ¥é”™ï¼š</p>
<pre><code>Error in download.file(url = &quot;http://www.jaredlander.com/data/ExcelExample.xlsx&quot;,  : 
  &#39;curl&#39; call had nonzero exit status</code></pre>
<p>æŠ¥é”™åŸå› åœ¨äºä¿å­˜è·¯å¾„ä¸å¯¹ï¼Œå› ä¸ºæœ¬åœ°çš„Rå·¥ä½œç›®å½•å¯èƒ½ä¸ä½œè€…çš„ä¸åŒï¼Œå·¥ä½œç›®å½•å¯ä»¥ç”¨getwd()æŸ¥çœ‹ï¼Œå¾ˆå¯èƒ½æœ¬åœ°å·¥ä½œç›®å½•ä¸‹é¢æ²¡æœ‰åˆ›å»ºdataæ–‡ä»¶å¤¹ï¼Œäºæ˜¯æŠ¥é”™ã€‚æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªdataæ–‡ä»¶å¤¹å³å¯ã€‚</p>
<p>ä½†äº‹æƒ…æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œå³ä½¿ä¸å†æŠ¥é”™ï¼Œä»ç½‘é¡µå†™åˆ°æœ¬åœ°çš„ä¹Ÿå¯èƒ½ï¼ˆæˆ–è€…è¯´ä¸€å®šï¼‰åªæ˜¯ä¸€ä¸ª1KBçš„xlsxæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•ä½¿ç”¨ï¼Œå³è¿™æ¬¡å†™å…¥å…¶å®æ˜¯å¤±è´¥äº†ã€‚å…·ä½“åŸå› æˆ‘ä¸æ¸…æ¥šï¼Œç»æŸ¥æ‰¾<a href="https://stackoverflow.com/questions/59697422/why-method-curl-is-not-working-in-download-file-in-r/59697717#59697717?newreg=636c77acc9b043e5a2b0f3fe04ae9b17">èµ„æ–™</a>,å¯ä»¥æ”¹ä¸ºè¿™æ ·å†™ï¼ˆå³å¯æˆåŠŸï¼‰ï¼š</p>
<pre><code>download.file(url=&#39;http://www.jaredlander.com/data/ExcelExample.xlsx&#39;,
              destfile=&#39;data/ExcelExample.xlsx&#39;,mode=&#39;wb&#39;)</code></pre>
</div>
<div id="p68-6.7-è¯»å–ç½‘é¡µæ•°æ®" class="section level3">
<h3>P68 â€œ6.7 è¯»å–ç½‘é¡µæ•°æ®*â€</h3>
<p>æœ¬èŠ‚æœ‰ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>library(XML)
theURL &lt;- &quot;http://www.jaredlander.com/2012/02/another-kind-of-super-bowl-pool/&quot;
bowlPool &lt;- readHTMLTable(theURL,which=1,header=FALSE,stringsAsFactors=FALSE)</code></pre>
<p>è¿è¡Œåº”è¯¥ä¼šæŠ¥é”™ï¼š</p>
<pre><code>Error: failed to load external entity &quot;http://www.jaredlander.com/2012/02/another-kind-of-super-bowl-pool/&quot;</code></pre>
<p>åŸå› æˆ‘å°šæœªæ¢ç©¶ï¼Œwebæ–¹é¢çš„æˆ‘æ¯”è¾ƒæ¬ ç¼ºï¼Œæš‚åªç•™å¾…ä»¥åè§£å†³ã€‚<br />
ä¸è¿‡è‹¥æ¢ç”¨è¯¾æœ¬ç´§æ¥æåˆ°çš„rveståŒ…ï¼Œåˆ™å°±å¯ä»¥æˆåŠŸæå–ï¼š</p>
<pre><code>library(rvest)
theURL &lt;- &quot;http://www.jaredlander.com/2012/02/another-kind-of-super-bowl-pool/&quot;
bowlPool &lt;- read_html(theURL) %&gt;% 
                 html_element(&quot;table&quot;) %&gt;% 
                 html_table()
#read_html() çˆ¬å–é¡µé¢æºä»£ç 
#html_element() æå–ç½‘é¡µä¸­æŒ‡å®šå…ƒç´ çš„éƒ¨åˆ†
#html_table() æ ¹æ®æå–çš„å…ƒç´ ç”Ÿæˆæ•°æ®æ¡†æˆ–åˆ—è¡¨</code></pre>
<p>è¯¾æœ¬åé¢æå–ç‰¹å®šå…ƒç´ ä½¿ç”¨çš„å‡½æ•°æ˜¯html_nodesï¼ˆç°åœ¨è¿˜å¯ä»¥ä½¿ç”¨ï¼‰ï¼Œå®˜ç½‘ç°åœ¨å·²ç»æ²¡æœ‰
è¿™ä¸ªå‡½æ•°çš„ä»‹ç»äº†ï¼Œå…¶æ–°çš„æ›¿ä»£å‡½æ•°æ˜¯html_elementsã€‚html_elementå’Œhtml_elementsæœ‰æ‰€
ä¸åŒï¼ŒåŠ â€œsâ€æœ€ç»ˆè¿”å›çš„ä¼šæ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚<br />
<em>Tipï¼šXMLåŒ…å¾ˆç»å…¸ï¼ŒHadley Wickhamå‚è€ƒå®ƒå¼€å‘äº†xml2åŒ…ï¼ˆ2015å¹´çš„blogï¼‰ï¼Œä¸¤ä¸ªåŒ…å­°ä¼˜å­°åŠ£ï¼Œå› ä¸ºæˆ‘å°šæœªæ¢ç©¶ï¼Œæ‰€ä»¥ä¸å¾—è€ŒçŸ¥ã€‚</em></p>
</div>
<div id="p82-7.2-ggplot2" class="section level3">
<h3>P82 â€œ7.2 ggplot2â€</h3>
<p>æœ¬èŠ‚æœ‰ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>econ2000 &lt;- economics[which(economics$year &gt;= 2000),]</code></pre>
<p>å»æ‰whichä¹Ÿå¯ä»¥ï¼š</p>
<pre class="r"><code>library(ggplot2)
library(lubridate)
economics$year &lt;- year(economics$date)
econ2000 &lt;- economics[which(economics$year &gt;= 2000),]
re_econ2000 &lt;- economics[economics$year &gt;= 2000,]
all(econ2000 == re_econ2000)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>ï¼ˆæˆ–è€…è¯´ä½¿ç”¨whichå¯ä»¥æé«˜è¿è¡Œæ•ˆç‡ï¼Ÿæš‚æŒ‰ã€‚ï¼‰</p>
</div>
<div id="p109-11.3-plyråŒ…" class="section level3">
<h3>P109 â€œ11.3 plyråŒ…â€</h3>
<p>æœ¬èŠ‚æœ‰ä»£ç å¦‚ä¸‹ï¼š<br />
&lt;1&gt;</p>
<pre class="r"><code>library(plyr)
system.time(
    replicate(1000,dlply(baseball,&quot;id&quot;,nrow))
)</code></pre>
<pre><code>##   ç”¨æˆ·   ç³»ç»Ÿ   æµé€ 
## 174.47   0.15 180.99</code></pre>
<pre class="r"><code>#æˆ‘æ“…è‡ªå¢åŠ äº†replicateå‡½æ•°
#å› ä¸ºåªè¿è¡Œä¸€æ¬¡çš„è¯å‡ ä¹è¿è¡Œæ—¶é•¿å¾ˆçŸ­ï¼Œå‡ ä¹çœ‹ä¸å‡ºå·®åˆ«</code></pre>
<p>&lt;2&gt;</p>
<pre class="r"><code>library(plyr)
iBaseball &lt;- idata.frame(baseball)
system.time(replicate(100,dlply(iBaseball,&quot;id&quot;,nrow)))</code></pre>
<pre><code>##  ç”¨æˆ·  ç³»ç»Ÿ  æµé€ 
## 24.06  0.01 24.35</code></pre>
<p>è¯¾æœ¬ä¸­ä¸¤è€…çš„è¿è¡Œæ—¶é—´åˆ†åˆ«ä¸º0.31å’Œ0.19ï¼Œè€Œè¿™é‡Œçš„è¿è¡Œç»“æœæ˜¯88.89å’Œ94.59ï¼Œä¸ºä½•ä¸¤ä¸ªç»“æœä¸ä¸€è‡´ï¼Œä¸æ¸…æ¥šã€‚ä¸è¿‡ä¹Ÿè®¸ä¸é‡è¦ï¼Œä½œè€…åé¢ä¹Ÿæåˆ°å°†æ•°æ®é›†è½¬æ¢ä¸ºidata.frameæ ¼å¼èƒ½ä¸èƒ½æé«˜æ•ˆç‡è¿˜å¾—æŒ‘æ•°æ®é›†ã€‚ğŸ˜µ</p>
<p>&lt;3&gt;<br />
ç°åœ¨æµ‹è¯•ä½¿ç”¨data.tableçš„æ•ˆç‡ï¼š</p>
<pre class="r"><code>library(data.table)
data(baseball,package = &quot;plyr&quot;)
bBaseball = data.table(baseball)
system.time(
  replicate(1000,
            bBaseball[,list(nrow=length(year)),by=id]
            )
)</code></pre>
<pre><code>## ç”¨æˆ· ç³»ç»Ÿ æµé€ 
## 6.33 0.75 6.73</code></pre>
<pre class="r"><code>#è¿™é‡Œä½¿ç”¨çš„æ˜¯lengthï¼ŒåŸå› æ˜¯nrowåœ¨è¿™å„¿ç”¨ä¸äº†ã€‚
#äº‹å®ä¸Šå¦‚æœæŠŠä¸Šé¢çš„ä¸¤æ®µä»£ç æ¢æˆlengthï¼Œè¿è¡Œæ—¶é—´å‡ ä¹ä¸ä½¿ç”¨nrowç›¸åŒã€‚</code></pre>
<p>ä»…ç”¨æ—¶ä¸¤ç§’ï¼ğŸ˜®</p>
<p>&lt;4&gt;<br />
å†æµ‹è¯•ä½¿ç”¨dplyråŒ…çš„æ•ˆç‡ï¼š</p>
<pre class="r"><code>library(dplyr)
data(baseball,package = &quot;plyr&quot;)
dBaseball = tibble(baseball)
system.time(
  replicate(1000,
            dBaseball %&gt;% 
              group_by(id) %&gt;% 
              summarize(nrow=nrow(year))
            )
)</code></pre>
<pre><code>##  ç”¨æˆ·  ç³»ç»Ÿ  æµé€ 
## 26.03  0.01 26.70</code></pre>
<p>ç”¨æ—¶åç§’ã€‚</p>
</div>
<div id="p139-12.11-dplyrä½¿ç”¨æ•°æ®åº“" class="section level3">
<h3>P139 â€œ12.11 dplyrä½¿ç”¨æ•°æ®åº“â€</h3>
<p>æœ¬èŠ‚æœ‰ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>download.file(&quot;http://www.jaredlander.com/data/diamonds.db&quot;,
              destfile=&quot;data/diamonds.db&quot;,mode = &quot;wb&quot;)
diaDBSource &lt;- src_sqlite(&quot;data/diamonds.db&quot;)</code></pre>
<p>æç¤ºé”™è¯¯ï¼šæ‰¾ä¸åˆ°src_sqliteå‡½æ•°ã€‚åŸå› æ˜¯ä½œè€…å†™ä½œæ—¶dplyråŒ…çš„ç‰ˆæœ¬ä¸º0.6ï¼Œç°åœ¨åˆ™ä¸º1.0.7ã€‚è€Œ1.0.0ç‰ˆæœ¬çš„ç›¸å…³æ›´æ–°è¯´æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>src_mysql(), src_postgres(), and src_sqlite() has been deprecated. Weâ€™ve recommended against them for some time. Instead please use the approach described at <a href="https://dbplyr.tidyverse.org/" class="uri">https://dbplyr.tidyverse.org/</a>.</p>
</blockquote>
<p>å³ç°åœ¨å»ºè®®ä½¿ç”¨dbplyrï¼ˆdplyrçš„æ”¯æ´åŒ…ï¼‰æ¥æ“çºµæ•°æ®åº“ã€‚dbplyrå®˜ç½‘ä¸­çš„å†™æ³•å·²ç»ä¸å†ä½¿ç”¨src_sqliteå‡½æ•°ï¼Œè€Œæ˜¯æ”¹ç”¨ä¹¦ä¸­æåˆ°çš„å¦ä¸€ç§åº”ç”¨é¢æ›´å¹¿çš„æ–¹æ³•ï¼šä½¿ç”¨DBI::dbConnect()å‡½æ•°ã€‚</p>
</div>
<div id="p172-16.3-æå–æ–‡æœ¬" class="section level3">
<h3>P172 â€œ16.3 æå–æ–‡æœ¬â€</h3>
<p>æœ¬èŠ‚æœ‰ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>library(XML)
load(&quot;dadta/presidents.rdata&quot;)
theURL &lt;- &quot;http://www.loc.gov//rr/print/list/057_chron.html&quot;
presidents &lt;- readHTMLTable(theURL,which=3,as.data.frame=TRUE,
                           skip.rows=1,header=TRUE,stringsAsFactors=FALSE)</code></pre>
<p>è¿è¡Œåº”è¯¥ä¼šæŠ¥é”™ï¼š</p>
<pre><code>Error: failed to load HTTP resource</code></pre>
<p>è¿›å…¥è¿™ä¸ªç½‘å€ï¼Œä¼šå‘ç°å…¶è®¾ç½®äº†éªŒè¯ç¨‹åºä»¥é˜²æ­¢çˆ¬å–æ•°æ®ã€‚</p>
<p>è§£å†³åŠæ³•ï¼šäººå·¥å¤åˆ¶è¿™ä¸ªç½‘é¡µçš„htmlæºä»£ç ï¼Œä¿å­˜ä¸ºæœ¬åœ°htmlæ–‡ä»¶ï¼Œç„¶åä»æœ¬åœ°çˆ¬å–ã€‚</p>
<p>ç¬¬äºŒç§çˆ¬å–åŠæ³•ï¼šä¿å­˜åˆ°æœ¬åœ°åï¼Œä½¿ç”¨ä¹‹å‰ä¹¦ä¸Šä»‹ç»è¿‡çš„rveståŒ…ã€‚å¯ä»¥ç›´æ¥çˆ¬å–å‡ºæ­£ç¡®çš„è¡¨ï¼š</p>
<pre><code>library(rvest)
#å‡è®¾æ–‡ä»¶è¢«ä¿å­˜ä¸ºbb.html
theURL &lt;- &quot;bb.html&quot;
presidents2 &lt;- (read_html(theURL) %&gt;% 
    html_elements(&quot;table&quot;) %&gt;% 
    html_table())[[4]]</code></pre>
</div>
</div>
<div id="è¿è¡Œç¯å¢ƒ" class="section level2">
<h2>è¿è¡Œç¯å¢ƒ</h2>
<pre class="r"><code>devtools::session_info()</code></pre>
<pre><code>## - Session info ---------------------------------------------------------------
##  setting  value
##  version  R version 4.1.2 (2021-11-01)
##  os       Windows 10 x64 (build 22000)
##  system   x86_64, mingw32
##  ui       RTerm
##  language (EN)
##  collate  Chinese (Simplified)_China.936
##  ctype    Chinese (Simplified)_China.936
##  tz       Asia/Taipei
##  date     2022-03-11
##  pandoc   2.17.0.1 @ D:/Program Files/Quarto/bin/ (via rmarkdown)
## 
## - Packages -------------------------------------------------------------------
##  package     * version date (UTC) lib source
##  assertthat    0.2.1   2019-03-21 [1] CRAN (R 4.1.2)
##  blogdown      1.7     2021-12-19 [1] CRAN (R 4.1.2)
##  bookdown      0.24    2021-09-02 [1] CRAN (R 4.1.2)
##  brio          1.1.3   2021-11-30 [1] CRAN (R 4.1.2)
##  bslib         0.3.1   2021-10-06 [1] CRAN (R 4.1.2)
##  cachem        1.0.6   2021-08-19 [1] CRAN (R 4.1.2)
##  callr         3.7.0   2021-04-20 [1] CRAN (R 4.1.2)
##  cli           3.1.0   2021-10-27 [1] CRAN (R 4.1.2)
##  colorspace    2.0-2   2021-06-24 [1] CRAN (R 4.1.2)
##  crayon        1.4.2   2021-10-29 [1] CRAN (R 4.1.2)
##  data.table  * 1.14.2  2021-09-27 [1] CRAN (R 4.1.2)
##  DBI           1.1.2   2021-12-20 [1] CRAN (R 4.1.2)
##  desc          1.4.0   2021-09-28 [1] CRAN (R 4.1.2)
##  devtools      2.4.3   2021-11-30 [1] CRAN (R 4.1.2)
##  digest        0.6.29  2021-12-01 [1] CRAN (R 4.1.2)
##  dplyr       * 1.0.7   2021-06-18 [1] CRAN (R 4.1.2)
##  ellipsis      0.3.2   2021-04-29 [1] CRAN (R 4.1.2)
##  evaluate      0.14    2019-05-28 [1] CRAN (R 4.1.2)
##  fansi         0.5.0   2021-05-25 [1] CRAN (R 4.1.2)
##  fastmap       1.1.0   2021-01-25 [1] CRAN (R 4.1.2)
##  fs            1.5.1   2021-11-30 [1] CRAN (R 4.1.2)
##  generics      0.1.1   2021-10-25 [1] CRAN (R 4.1.2)
##  ggplot2     * 3.3.5   2021-06-25 [1] CRAN (R 4.1.2)
##  glue          1.5.1   2021-11-30 [1] CRAN (R 4.1.2)
##  gtable        0.3.0   2019-03-25 [1] CRAN (R 4.1.2)
##  htmltools     0.5.2   2021-08-25 [1] CRAN (R 4.1.2)
##  jquerylib     0.1.4   2021-04-26 [1] CRAN (R 4.1.2)
##  jsonlite      1.7.2   2020-12-09 [1] CRAN (R 4.1.2)
##  knitr         1.37    2021-12-16 [1] CRAN (R 4.1.2)
##  lifecycle     1.0.1   2021-09-24 [1] CRAN (R 4.1.2)
##  lubridate   * 1.8.0   2021-10-07 [1] CRAN (R 4.1.2)
##  magrittr    * 2.0.1   2020-11-17 [1] CRAN (R 4.1.2)
##  memoise       2.0.1   2021-11-26 [1] CRAN (R 4.1.2)
##  munsell       0.5.0   2018-06-12 [1] CRAN (R 4.1.2)
##  pillar        1.6.4   2021-10-18 [1] CRAN (R 4.1.2)
##  pkgbuild      1.3.1   2021-12-20 [1] CRAN (R 4.1.2)
##  pkgconfig     2.0.3   2019-09-22 [1] CRAN (R 4.1.2)
##  pkgload       1.2.4   2021-11-30 [1] CRAN (R 4.1.2)
##  plyr        * 1.8.6   2020-03-03 [1] CRAN (R 4.1.2)
##  prettyunits   1.1.1   2020-01-24 [1] CRAN (R 4.1.2)
##  processx      3.5.2   2021-04-30 [1] CRAN (R 4.1.2)
##  ps            1.6.0   2021-02-28 [1] CRAN (R 4.1.2)
##  purrr         0.3.4   2020-04-17 [1] CRAN (R 4.1.2)
##  R6            2.5.1   2021-08-19 [1] CRAN (R 4.1.2)
##  Rcpp          1.0.7   2021-07-07 [1] CRAN (R 4.1.2)
##  remotes       2.4.2   2021-11-30 [1] CRAN (R 4.1.2)
##  rlang         0.4.12  2021-10-18 [1] CRAN (R 4.1.2)
##  rmarkdown     2.11    2021-09-14 [1] CRAN (R 4.1.2)
##  rprojroot     2.0.2   2020-11-15 [1] CRAN (R 4.1.2)
##  rstudioapi    0.13    2020-11-12 [1] CRAN (R 4.1.2)
##  sass          0.4.0   2021-05-12 [1] CRAN (R 4.1.2)
##  scales        1.1.1   2020-05-11 [1] CRAN (R 4.1.2)
##  sessioninfo   1.2.2   2021-12-06 [1] CRAN (R 4.1.2)
##  stringi       1.7.6   2021-11-29 [1] CRAN (R 4.1.2)
##  stringr       1.4.0   2019-02-10 [1] CRAN (R 4.1.2)
##  testthat      3.1.2   2022-01-20 [1] CRAN (R 4.1.2)
##  tibble        3.1.6   2021-11-07 [1] CRAN (R 4.1.2)
##  tidyselect    1.1.1   2021-04-30 [1] CRAN (R 4.1.2)
##  usethis       2.1.5   2021-12-09 [1] CRAN (R 4.1.2)
##  utf8          1.2.2   2021-07-24 [1] CRAN (R 4.1.2)
##  vctrs         0.3.8   2021-04-29 [1] CRAN (R 4.1.2)
##  withr         2.4.3   2021-11-30 [1] CRAN (R 4.1.2)
##  xfun          0.29    2021-12-14 [1] CRAN (R 4.1.2)
##  yaml          2.2.1   2020-02-01 [1] CRAN (R 4.1.1)
## 
##  [1] D:/Program Files/R/R-4.1.2/library
## 
## ------------------------------------------------------------------------------</code></pre>
</div>
